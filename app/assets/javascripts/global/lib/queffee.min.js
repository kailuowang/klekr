var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__slice=Array.prototype.slice;this.queffee={},queffee.Node=function(){function a(a,b,c){this.array=a,this.index=b,this.comp=c!=null?c:function(a,b){return a>b},this._valid=__bind(this._valid,this),this._comp=__bind(this._comp,this),this._isRoot=__bind(this._isRoot,this),this._swap=__bind(this._swap,this),this._findSmallerChildren=__bind(this._findSmallerChildren,this),this.child_=__bind(this.child_,this),this.siftUp=__bind(this.siftUp,this),this.siftDown=__bind(this.siftDown,this),this.heapify=__bind(this.heapify,this),this.parent=__bind(this.parent,this),this.right=__bind(this.right,this),this.left=__bind(this.left,this),this.value=__bind(this.value,this)}a.prototype.value=function(a){return a!=null&&this._valid()?this.array[this.index]=a:this.array[this.index]},a.prototype.left=function(){var a;return(a=this._left)!=null?a:this._left=this.child_(2*this.index+1)},a.prototype.right=function(){var a;return(a=this._right)!=null?a:this._right=this.child_(2*this.index+2)},a.prototype.parent=function(){var b;return(b=this._parent)!=null?b:this._parent=new a(this.array,Math.floor(this.index/2),this.comp)},a.prototype.heapify=function(){this.left()!=null&&this.left().heapify(),this.right()!=null&&this.right().heapify();return this.siftDown()},a.prototype.siftDown=function(){var a;a=this._findSmallerChildren();if(a!=null&&this._comp(a,this)){this._swap(a);return a.siftDown()}},a.prototype.siftUp=function(){if(!this._isRoot()&&this._comp(this,this.parent())){this._swap(this.parent());return this.parent().siftUp()}},a.prototype.child_=function(b){return b<this.array.length?new a(this.array,b,this.comp):null},a.prototype._findSmallerChildren=function(){return this.left()!=null&&this.right()!=null?this._comp(this.left(),this.right())?this.left():this.right():this.left()!=null?this.left():this.right()},a.prototype._swap=function(a){var b;b=this.value(),this.value(a.value());return a.value(b)},a.prototype._isRoot=function(){return this.index===0},a.prototype._comp=function(a,b){return this.comp(a.value(),b.value())},a.prototype._valid=function(){return this.index<this.array.length};return a}(),queffee.Heap=function(){function a(a,b){this._array=a!=null?a:[],this.comp=b!=null?b:function(a,b){return a>b},this._init=__bind(this._init,this),this._last=__bind(this._last,this),this.reorder=__bind(this.reorder,this),this.insert=__bind(this.insert,this),this.extractTop=__bind(this.extractTop,this),this.top=__bind(this.top,this),this.size=__bind(this.size,this),this._init(),this.reorder()}a.prototype.size=function(){return this._array.length},a.prototype.top=function(){return this._root.value()},a.prototype.extractTop=function(){var a,b;b=this.top(),a=this._array.pop(),this._init(),this._root.value(a),this._root.siftDown();return b},a.prototype.insert=function(a){this._array.push(a);return this._last().siftUp()},a.prototype.reorder=function(){return this._root.heapify()},a.prototype._last=function(){return new queffee.Node(this._array,this._array.length-1,this.comp)},a.prototype._init=function(){return this._root=new queffee.Node(this._array,0,this.comp)};return a}(),queffee.Job=function(){function a(a,b,c){this.perform=a,this._priority=b,this._timeout=c,this.timeout=__bind(this.timeout,this),this.priority=__bind(this.priority,this)}a.prototype.priority=function(){return(typeof this._priority=="function"?this._priority():void 0)||this._priority},a.prototype.timeout=function(){return(typeof this._timeout=="function"?this._timeout():void 0)||this._timeout};return a}(),queffee.Q=function(){function a(a){a==null&&(a=[]),this._initHeap=__bind(this._initHeap,this),this.clear=__bind(this.clear,this),this.size=__bind(this.size,this),this.reorder=__bind(this.reorder,this),this.dequeue=__bind(this.dequeue,this),this.enQ=__bind(this.enQ,this),this.enqueue=__bind(this.enqueue,this),this.Q=__bind(this.Q,this),this._initHeap(a),this.onNewJobAdded=null}a._compareJob=function(a,b){return a.priority()>b.priority()},a.prototype.enqueue=function(){var a,b,c,d;b=1<=arguments.length?__slice.call(arguments,0):[];for(c=0,d=b.length;c<d;c++)a=b[c],this._heap.insert(a);return typeof this.onNewJobAdded=="function"?this.onNewJobAdded():void 0},a.prototype.enQ=function(a,b,c){return this.enqueue(new queffee.Job(a,b,c))},a.prototype.dequeue=function(){return this._heap.extractTop()},a.prototype.reorder=function(){return this._heap.reorder()},a.prototype.size=function(){return this._heap.size()},a.prototype.clear=function(){return this._heap=this._initHeap([])},a.prototype._initHeap=function(a){return this._heap=new queffee.Heap(a,queffee.Q._compareJob)};return a}(),queffee.Worker=function(){function a(a,b){this.q=a,this.onIdle=b,this._prepareForTimeout=__bind(this._prepareForTimeout,this),this._work=__bind(this._work,this),this.idle=__bind(this.idle,this),this.start=__bind(this.start,this),this.idle_=!0,this.q.onNewJobAdded=__bind(function(){if(this.idle_)return this._work()},this)}a.prototype.start=function(){return this._work()},a.prototype.idle=function(){return this.idle_},a.prototype._work=function(){var a;a=this.q.dequeue();if(this.idle_=a==null)return typeof this.onIdle=="function"?this.onIdle():void 0;a.perform(this._work);return this._prepareForTimeout(a)},a.prototype._prepareForTimeout=function(a){if((typeof a.timeout=="function"?a.timeout():void 0)!=null)return setTimeout(this._work,a.timeout())};return a}(),queffee.CollectionWorkQ=function(){function a(a){this._itemDone=__bind(this._itemDone,this),this._createJob=__bind(this._createJob,this),this._createJobs=__bind(this._createJobs,this),this.start=__bind(this.start,this),this.collection=a.collection,this.operation=a.operation,this.onProgress=a.onProgress,this.onFinish=a.onFinish}a.prototype.start=function(){var a;a=new queffee.Q(this._createJobs());return(new queffee.Worker(a,this.onFinish)).start()},a.prototype._createJobs=function(){var a,b,c,d,e;d=this.collection,e=[];for(a=0,c=d.length;a<c;a++)b=d[a],e.push(this._createJob(b,a));return e},a.prototype._createJob=function(a,b){var c;c=typeof this.operation=="string"?__bind(function(c){return a[this.operation](__bind(function(){return this._itemDone(b,c)},this))},this):__bind(function(c){return this.operation(a,__bind(function(){return this._itemDone(b,c)},this))},this);return new queffee.Job(c,-b)},a.prototype._itemDone=function(a,b){typeof this.onProgress=="function"&&this.onProgress(a+1);return b()};return a}()